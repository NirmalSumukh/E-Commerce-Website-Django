{% extends "oscar/layout.html" %}
{% load static %}

{% block title %}{{ post.title }} | Blog | {{ block.super }}{% endblock %}

{% block description %}
    {% if post.excerpt %}
        {{ post.excerpt|striptags|truncatewords:25 }}
    {% else %}
        {{ post.content|striptags|truncatewords:25 }}
    {% endif %}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<!-- SEO Meta Tags -->
<meta name="author" content="{{ post.author.get_full_name|default:post.author.username }}">
<meta name="keywords" content="{% for tag in post.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{% if post.excerpt %}{{ post.excerpt|striptags }}{% else %}{{ post.content|striptags|truncatewords:25 }}{% endif %}">
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
{% if post.featured %}
<meta property="og:image" content="{{ request.build_absolute_uri }}{{ post.featured.url }}">
{% endif %}
<meta property="article:author" content="{{ post.author.get_full_name|default:post.author.username }}">
<meta property="article:published_time" content="{{ post.published_at|date:'c' }}">
<meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}">
{% for tag in post.tags.all %}
<meta property="article:tag" content="{{ tag.name }}">
{% endfor %}

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ post.title }}">
<meta name="twitter:description" content="{% if post.excerpt %}{{ post.excerpt|striptags }}{% else %}{{ post.content|striptags|truncatewords:25 }}{% endif %}">
{% if post.featured %}
<meta name="twitter:image" content="{{ request.build_absolute_uri }}{{ post.featured.url }}">
{% endif %}

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ post.title }}",
  "description": "{% if post.excerpt %}{{ post.excerpt|striptags }}{% else %}{{ post.content|striptags|truncatewords:25 }}{% endif %}",
  "author": {
    "@type": "Person",
    "name": "{{ post.author.get_full_name|default:post.author.username }}"
  },
  "datePublished": "{{ post.published_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  {% if post.featured %}
  "image": "{{ request.build_absolute_uri }}{{ post.featured.url }}",
  {% endif %}
  "url": "{{ request.build_absolute_uri }}",
  "keywords": "{% for tag in post.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}"
}
</script>
{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'blog:list' %}">Blog</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ post.title|truncatewords:5 }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<article class="container py-4">
    <!-- Back to Blog Button -->
    <div class="row mb-4">
        <div class="col-12">
            <a href="{% url 'blog:list' %}" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left me-2"></i>Back to Blog
            </a>
        </div>
    </div>

    <!-- Hero Section -->
    <header class="row mb-5">
        <div class="col-12">
            <div class="blog-hero">
                <!-- Post Title -->
                <h1 class="display-4 fw-bold mb-4 text-dark">{{ post.title }}</h1>
                
                <!-- Post Meta Information -->
                <div class="post-meta d-flex flex-wrap align-items-center mb-4">
                    <div class="author-info d-flex align-items-center me-4 mb-2">
                        <div class="author-avatar me-2">
                            {% if post.author.profile.avatar %}
                                <img src="{{ post.author.profile.avatar.url }}" 
                                     alt="{{ post.author.get_full_name|default:post.author.username }}"
                                     class="rounded-circle" width="40" height="40">
                            {% else %}
                                <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="author-details">
                            <span class="fw-bold text-dark">{{ post.author.get_full_name|default:post.author.username }}</span>
                        </div>
                    </div>
                    
                    <div class="date-info me-4 mb-2">
                        <i class="fas fa-calendar text-muted me-2"></i>
                        <span class="text-muted">{{ post.published_at|date:"F d, Y" }}</span>
                    </div>
                    
                    <div class="reading-time me-4 mb-2">
                        <i class="fas fa-clock text-muted me-2"></i>
                        <span class="text-muted">{{ post.content|wordcount|floatdiv:200|floatformat:0 }} min read</span>
                    </div>
                </div>

                <!-- Tags -->
                {% if post.tags.all %}
                <div class="post-tags mb-4">
                    {% for tag in post.tags.all %}
                        <span class="badge bg-primary me-2 mb-1">
                            <i class="fas fa-tag fa-sm me-1"></i>{{ tag.name }}
                        </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Social Sharing Buttons -->
                <div class="social-share mb-4">
                    <span class="text-muted me-3">Share this post:</span>
                    <div class="share-buttons d-inline-flex">
                        <!-- Twitter Share -->
                        <a href="https://twitter.com/intent/tweet?text={{ post.title|urlencode }}&url={{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" 
                           class="btn btn-outline-info btn-sm me-2"
                           title="Share on Twitter">
                            <i class="fab fa-twitter me-1"></i>Twitter
                        </a>
                        
                        <!-- Facebook Share -->
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" 
                           class="btn btn-outline-primary btn-sm me-2"
                           title="Share on Facebook">
                            <i class="fab fa-facebook-f me-1"></i>Facebook
                        </a>
                        
                        <!-- LinkedIn Share -->
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" 
                           class="btn btn-outline-primary btn-sm me-2"
                           title="Share on LinkedIn">
                            <i class="fab fa-linkedin-in me-1"></i>LinkedIn
                        </a>
                        
                        <!-- Copy Link -->
                        <button class="btn btn-outline-secondary btn-sm" 
                                onclick="copyToClipboard('{{ request.build_absolute_uri }}')"
                                title="Copy link">
                            <i class="fas fa-link me-1"></i>Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="row">
        <!-- Main Content Area -->
        <div class="col-lg-8 col-md-12">
            <!-- Featured Image -->
            {% if post.featured %}
            <div class="featured-image-container mb-5">
                <img src="{{ post.featured.url }}" 
                     alt="{{ post.title }}" 
                     class="img-fluid rounded shadow-sm featured-image">
            </div>
            {% endif %}

            <!-- Post Content -->
            <div class="blog-content mb-5">
                {{ post.content|safe }}
            </div>

            <!-- Post Footer -->
            <footer class="post-footer border-top pt-4">
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">
                            <i class="fas fa-calendar-plus me-1"></i>Published: {{ post.published_at|date:"F d, Y" }}<br>
                            <i class="fas fa-edit me-1"></i>Last updated: {{ post.updated_at|date:"F d, Y" }}
                        </small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <div class="share-buttons-footer">
                            <span class="text-muted me-2">Share:</span>
                            <a href="https://twitter.com/intent/tweet?text={{ post.title|urlencode }}&url={{ request.build_absolute_uri|urlencode }}" 
                               target="_blank" class="text-info me-2" title="Share on Twitter">
                                <i class="fab fa-twitter fa-lg"></i>
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
                               target="_blank" class="text-primary me-2" title="Share on Facebook">
                                <i class="fab fa-facebook-f fa-lg"></i>
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}" 
                               target="_blank" class="text-primary" title="Share on LinkedIn">
                                <i class="fab fa-linkedin-in fa-lg"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4 col-md-12">
            <aside class="blog-sidebar">
                <!-- Author Information Box -->
                <div class="author-box card mb-4">
                    <div class="card-body text-center">
                        <h5 class="card-title mb-3">About the Author</h5>
                        
                        <!-- Author Avatar -->
                        <div class="author-avatar-large mb-3">
                            {% if post.author.profile.avatar %}
                                <img src="{{ post.author.profile.avatar.url }}" 
                                     alt="{{ post.author.get_full_name|default:post.author.username }}"
                                     class="rounded-circle shadow-sm" width="80" height="80">
                            {% else %}
                                <div class="avatar-placeholder-large rounded-circle d-flex align-items-center justify-content-center mx-auto shadow-sm">
                                    <i class="fas fa-user fa-2x"></i>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Author Details -->
                        <h6 class="fw-bold">{{ post.author.get_full_name|default:post.author.username }}</h6>
                        
                        {% if post.author.profile.bio %}
                            <p class="text-muted small">{{ post.author.profile.bio }}</p>
                        {% else %}
                            <p class="text-muted small">Content creator and blogger passionate about sharing knowledge and insights.</p>
                        {% endif %}
                        
                        <!-- Contact Information -->
                        <div class="author-contact mt-3">
                            {% if post.author.email %}
                            <a href="mailto:{{ post.author.email }}" 
                               class="btn btn-outline-primary btn-sm me-2 mb-2"
                               title="Email {{ post.author.get_full_name|default:post.author.username }}">
                                <i class="fas fa-envelope me-1"></i>Email
                            </a>
                            {% endif %}
                            
                            {% if post.author.profile.website %}
                            <a href="{{ post.author.profile.website }}" 
                               target="_blank" 
                               class="btn btn-outline-secondary btn-sm mb-2"
                               title="Visit website">
                                <i class="fas fa-globe me-1"></i>Website
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Related Posts (if you implement this later) -->
                <div class="related-posts card">
                    <div class="card-header">
                        <h6 class="mb-0">More from this author</h6>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">Explore more articles from {{ post.author.get_full_name|default:post.author.username }}.</p>
                        <a href="{% url 'blog:list' %}?author={{ post.author.username }}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-user me-1"></i>View All Posts
                        </a>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</article>
{% endblock %}

{% block extrastyles %}
{{ block.super }}
<style>
/* Hero Section Styling */
.blog-hero {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    padding: 2rem;
    border-radius: 1rem;
    margin-bottom: 2rem;
}

/* Author Avatar Styling */
.avatar-placeholder, .avatar-placeholder-large {
    background: linear-gradient(135deg, #6c757d, #495057);
    color: white;
    width: 40px;
    height: 40px;
}

.avatar-placeholder-large {
    width: 80px;
    height: 80px;
}

/* Featured Image Styling */
.featured-image-container {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
}

.featured-image {
    width: 100%;
    height: auto;
    max-height: 400px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.featured-image:hover {
    transform: scale(1.02);
}

/* Blog Content Styling */
.blog-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #2c3e50;
}

.blog-content h1, .blog-content h2, .blog-content h3 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #2c3e50;
}

.blog-content h1 { font-size: 2rem; }
.blog-content h2 { font-size: 1.75rem; }
.blog-content h3 { font-size: 1.5rem; }

.blog-content p {
    margin-bottom: 1.5rem;
}

.blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    margin: 1.5rem 0;
}

.blog-content blockquote {
    border-left: 4px solid #0d6efd;
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: #6c757d;
    background: #f8f9fa;
    padding: 1rem 1rem 1rem 2rem;
    border-radius: 0 0.5rem 0.5rem 0;
}

.blog-content code {
    background: #f1f3f4;
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.9rem;
}

.blog-content pre {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    border: 1px solid #dee2e6;
}

/* Post Meta Styling */
.post-meta {
    font-size: 0.95rem;
}

/* Social Share Buttons */
.share-buttons a {
    text-decoration: none;
    transition: all 0.2s ease;
}

.share-buttons a:hover {
    transform: translateY(-2px);
}

/* Author Box Styling */
.author-box {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border: 1px solid #e9ecef;
}

/* Tags Styling */
.post-tags .badge {
    font-size: 0.8rem;
    padding: 0.5rem 0.75rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .blog-hero {
        padding: 1.5rem;
    }
    
    .display-4 {
        font-size: 2rem;
    }
    
    .post-meta {
        flex-direction: column;
        align-items: flex-start !important;
    }
    
    .post-meta > div {
        margin-bottom: 0.5rem;
    }
    
    .social-share {
        text-align: center;
    }
    
    .share-buttons {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .blog-content {
        font-size: 1rem;
    }
}

/* Print Styles */
@media print {
    .social-share, .share-buttons-footer, .author-contact {
        display: none;
    }
}
</style>
{% endblock %}

{% block extrajs %}
{{ block.super }}
<script>
// Copy to clipboard function
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Show success message
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
        btn.classList.replace('btn-outline-secondary', 'btn-success');
        
        setTimeout(function() {
            btn.innerHTML = originalText;
            btn.classList.replace('btn-success', 'btn-outline-secondary');
        }, 2000);
    });
}

// Social sharing analytics (optional)
document.querySelectorAll('.share-buttons a').forEach(function(link) {
    link.addEventListener('click', function() {
        // Track social sharing events
        const platform = this.querySelector('i').classList.contains('fa-twitter') ? 'twitter' : 
                        this.querySelector('i').classList.contains('fa-facebook-f') ? 'facebook' : 'linkedin';
        console.log('Shared on:', platform);
        // Add your analytics tracking code here
    });
});
</script>
{% endblock %}
